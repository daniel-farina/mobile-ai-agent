#!/bin/bash
# Password-based SSH access to Mobile AI Agent
# Username: claude
# Password: claude

# Parse arguments
if [[ $1 == "--help" || $1 == "-h" ]]; then
    echo "🔐 Mobile AI Agent - Password Authentication"
    echo ""
    echo "Usage: $0 [HOST] [PORT] [COMMAND]"
    echo ""
    echo "Examples:"
    echo "  $0                                    # Connect to localhost:22"
echo "  $0 100.64.246.92                     # Connect to remote host"
echo "  $0 100.64.246.92 22                  # Connect with custom port"
echo "  $0 localhost 22 'pm2 status'         # Run command and exit"
    echo ""
    echo "Credentials:"
    echo "  Username: claude"
    echo "  Password: claude"
    exit 0
fi

# Default values
HOST=${1:-localhost}
PORT=${2:-22}

# Check if third argument is a command
if [[ $# -gt 2 ]]; then
    COMMAND="${@:3}"
    echo "🔐 Mobile AI Agent - Password Authentication"
    echo "Username: claude"
    echo "Password: claude"
    echo "Host: $HOST:$PORT"
    echo "Command: $COMMAND"
    echo ""
    
    # Check if sshpass is available
    if ! command -v sshpass &> /dev/null; then
        echo "❌ sshpass not found. Installing..."
        if command -v brew &> /dev/null; then
            brew install sshpass
        elif command -v apt-get &> /dev/null; then
            sudo apt-get update && sudo apt-get install -y sshpass
        else
            echo "Please install sshpass manually:"
            echo "  macOS: brew install sshpass"
            echo "  Ubuntu: sudo apt-get install sshpass"
            exit 1
        fi
    fi
    
    # Run command with password
    sshpass -p claude ssh -o StrictHostKeyChecking=accept-new -o UserKnownHostsFile=/dev/null -o GlobalKnownHostsFile=/dev/null -o LogLevel=ERROR claude@$HOST -p $PORT "$COMMAND"
else
    echo "🔐 Mobile AI Agent - Password Authentication"
    echo "Username: claude"
    echo "Password: claude"
    echo "Host: $HOST:$PORT"
    echo ""
    
    # Check if sshpass is available
    if ! command -v sshpass &> /dev/null; then
        echo "❌ sshpass not found. Installing..."
        if command -v brew &> /dev/null; then
            brew install sshpass
        elif command -v apt-get &> /dev/null; then
            sudo apt-get update && sudo apt-get install -y sshpass
        else
            echo "Please install sshpass manually:"
            echo "  macOS: brew install sshpass"
            echo "  Ubuntu: sudo apt-get install sshpass"
            exit 1
        fi
    fi
    
    # Connect with password
    sshpass -p claude ssh -o StrictHostKeyChecking=accept-new -o UserKnownHostsFile=/dev/null -o GlobalKnownHostsFile=/dev/null -o LogLevel=ERROR claude@$HOST -p $PORT
fi
